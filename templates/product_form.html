{% extends "base.html" %}
{% block content %}
<div class="card" style="max-width:720px; margin:1rem auto;">
  <h2>Agregar Producto</h2>
  {% if error and not error_field %}
    <div class="alert alert-error">{{ error }}</div>
  {% endif %}
  <form method="POST" action="/products/new">
    <div class="field">
      <label class="label">Código de barras</label>
      <div style="display:flex; gap:0.5rem;">
        <input id="barrs_code" name="barrs_code" placeholder="EAN / UPC / Code128" 
               value="{{ form_data.barrs_code or '' }}" maxlength="{{Limits.ITEM_BARCODE_MAX}}"
               class="{{ 'input-error' if error_field == 'Código de barras' else '' }}" />
      </div>
      {% if error_field == 'Código de barras' %}
        <span class="field-error">{{ error }}</span>
      {% endif %}
    </div>
    <div class="field">
      <label class="label">Nombre</label>
      <input name="name" required maxlength="{{Limits.ITEM_NAME_MAX}}"
             value="{{ form_data.name or '' }}"
             class="{{ 'input-error' if error_field == 'Nombre' else '' }}" />
      {% if error_field == 'Nombre' %}
        <span class="field-error">{{ error }}</span>
      {% endif %}
    </div>
    <div class="field">
      <label class="label">Descripción</label>
      <input name="description" maxlength="{{Limits.ITEM_DESCRIPTION_MAX}}"
             value="{{ form_data.description or '' }}"
             class="{{ 'input-error' if error_field == 'Descripción' else '' }}" />
      {% if error_field == 'Descripción' %}
        <span class="field-error">{{ error }}</span>
      {% endif %}
    </div>
    <div class="field">
      <label class="label">Stock</label>
      <input type="number" name="quantity" min="0" max="{{Limits.ITEM_QUANTITY_MAX}}"
             value="{{ form_data.quantity or 0 }}"
             class="{{ 'input-error' if error_field == 'Cantidad' else '' }}" />
      {% if error_field == 'Cantidad' %}
        <span class="field-error">{{ error }}</span>
      {% endif %}
    </div>
    <div class="field">
      <label class="label">Stock mínimo</label>
      <input type="number" name="min_quantity" min="0" max="{{Limits.ITEM_MIN_QUANTITY_MAX}}"
             value="{{ form_data.min_quantity or 0 }}"
             class="{{ 'input-error' if error_field == 'Cantidad mínima' else '' }}" />
      {% if error_field == 'Cantidad mínima' %}
        <span class="field-error">{{ error }}</span>
      {% endif %}
    </div>
    <div class="field">
      <label class="label">Precio</label>
      <input type="number" step="0.01" name="price" min="0" max="{{Limits.ITEM_PRICE_MAX}}"
             value="{{ form_data.price or '0.00' }}"
             class="{{ 'input-error' if error_field == 'Precio' else '' }}" />
      {% if error_field == 'Precio' %}
        <span class="field-error">{{ error }}</span>
      {% endif %}
    </div>
    <div class="form-actions">
      <a href="/" class="btn btn-ghost">Cancelar</a>
      <button class="btn" type="submit">Agregar</button>
    </div>
  </form>
</div>
<script>
document.querySelectorAll('input[type="number"][max]').forEach(input => {
  input.addEventListener('input', function() {
    const max = parseFloat(this.max);
    const min = parseFloat(this.min) || 0;
    let value = parseFloat(this.value);
    
    if (value > max) this.value = max;
    if (value < min) this.value = min;
  });
});
</script>
{% endblock %}